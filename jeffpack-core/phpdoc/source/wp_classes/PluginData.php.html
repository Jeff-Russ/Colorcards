<html>
    <head>
        <script
            type="text/javascript"
            src="../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * PluginData is a set of methods which which gather all information needed by 
 * a plugin and stores them to $this-&gt;info, an array. It also has a $this-&gt;logs, 
 * also an array, which can be populated with information to be output to the 
 * admin panel or a file, etc and can be used to enforce minimum PHP and 
 * WordPress versions. 
 * 
 * Since the plugin's identity is typically determined via the file being 
 * exectuted, this class must be constructed ($ob = new Whatever(); ) from the 
 * main php file (the one detailing the plugin information via the comment 
 * header).  
 * 
 * @package     JeffPack
 * @subpackage  WordPress Classes
 * @access      public
 * @author      Jeff Russ
 * @copyright   2016 Jeff Russ
 * @license     GPL-2.0
 */
if ( ! class_exists('PluginData'))
{
	// include_once substr( __FILE__, 0, strpos(__FILE__, &quot;wp-content&quot;) ).'wp-admin/includes/file.php';
	// include_once substr( __FILE__, 0, strpos(__FILE__, &quot;wp-content&quot;) ).'wp-admin/includes/plugin.php';

	/**
	 * PluginData is a set of methods which which gather all information needed by 
	 * a plugin and stores them to $this-&gt;info, an array. It also has a $this-&gt;logs, 
	 * also an array, which can be populated with information to be output to the 
	 * admin panel or a file, etc and can be used to enforce minimum PHP and 
	 * WordPress versions. 
	 */
	class PluginData extends PersistArgs # extends HelperModule
	{
		#__ Properties ____________________________________________________________

		/** @var array holding plugin, WordPress, PHP and server data */
		public $info = array(); # array holding info server data

		/** @var array to be populated with log info for output to the admin panel, file, etc.*/
		public $logs = array(); 

		#__ Constructor ___________________________________________________________

		/**
		* Calls enforceVersions() and setInfo().
		*
		* @param  string  $min_php sets $this-&gt;['min_php'] or '4.4.0' if not provided
		* @param  string  $min_wp sets $this-&gt;['min_wp'] or '5.3.0' if not provided
		* @param  string  $plugin_file should be __FILE__ from main php file and 
		* is determined via debug_backtrace()[0]['file'] if not provided. It is used 
		* to set $this-&gt;info['plugin_file'] 
		* @access public
		*/
		public function __construct( $min_php=null, $min_wp=null, $plugin_file=null )
		{
			$this-&gt;info['min_php'] = ($min_php === null ) ? $min_php : '4.4.0';
			$this-&gt;info['min_wp'] = ($min_wp === null ) ? $min_wp : '5.3.0';

			if ($plugin_file === null ) {
				$this-&gt;info['plugin_file'] = debug_backtrace()[0]['file'];
			} else {
				$this-&gt;info['plugin_file'] = $plugin_file;
			}
			$this-&gt;enforceVersions();
			$this-&gt;setInfo();
		}

		#### Helpers ##############################################################

		/**
		* Calls wp_die if minimum WordPress or PHP version are not met.
		*
		* @param  string  $min_php resets $this-&gt;['min_php'] only if provided
		* @param  string  $min_wp resets $this-&gt;['min_wp'] only if provided
		* @param  string  $plugin_file resets $this-&gt;['plugin_file'] only if provided
		* @access public
		*/
		public function enforceVersions( $min_php=null, $min_wp=null, $plugin_file=null )
		{
			if ($min_php !== null ) $this-&gt;info['min_php'] = $min_php;
			if ($min_wp !== null ) $this-&gt;info['min_wp'] = $min_wp;
			if ($plugin_file !== null ) $this-&gt;info['plugin_file'] = $plugin_file;

			global $wp_version;
			if (version_compare(PHP_VERSION, $min_php, '&lt;' )) $flag='PHP';
			elseif (version_compare($wp_version, $min_wp, '&lt;' )) $flag='WordPress';
			else $flag = false;

			if ($flag !== false) {
				$version = ($flag === 'PHP' ) ? $min_php : $min_wp;

				# plugin_basename() is located in wp-includes/plugin.php
				$basen = plugin_basename($this-&gt;info['plugin_file']);

				# deactivate_plugins() is located in wp-admin/includes/plugin.php
				deactivate_plugins( $basen );

				$opts = array( 'response'=&gt;200, 'back_link'=&gt;TRUE );

				# wp_die() is located in wp-includes/functions.php
				wp_die (&quot;&lt;p&gt;&lt;strong&gt;$basen&lt;/strong&gt; requires &quot; 
					. $flag . ' version ' . $version .' or greater.&lt;/p&gt;',
					'Plugin Activation Error', $opts);
			}
		}

		/**
		* Sets a miriad of keys on $this-&gt;info - 'plugin_name', 'plugin_uri', 
		* 'plugin_version', 'plugin_description', 'plugin_author',
		* 'plugin_author_uri', 'plugin_text_domain', 'plugin_domain_path', 
		* 'plugin_network', 'plugin_title', 'plugin_author_name', 
		* 'plugin_author_name', 'plugin_basename', 'plugin_path',
		* 'plugin_slug', 'plugin_prefix', 'plugin_url', 'server_ip',
		* and, if provided as arguments, 'min_php', 'min_wp' and 'plugin_file'
		*
		* @param  string  $min_php resets $this-&gt;['min_php'] only if provided
		* @param  string  $min_wp resets $this-&gt;['min_wp'] only if provided
		* @param  string  $plugin_file resets $this-&gt;['plugin_file'] only if provided
		* @access public
		*/
		public function setInfo( $min_php=null, $min_wp=null, $plugin_file=null )
		{
			if ($min_php !== null ) $this-&gt;info['min_php'] = $min_php;
			if ($min_wp !== null ) $this-&gt;info['min_wp'] = $min_wp;
			if ($plugin_file !== null ) $this-&gt;info['plugin_file'] = $plugin_file;

			# get_plugin_data() is located in wp-admin/includes/plugin.php
			$plugin_data = get_plugin_data($this-&gt;info['plugin_file']);
			$this-&gt;info['plugin_name'] = $plugin_data['Name'];
			$this-&gt;info['plugin_uri'] = $plugin_data['PluginURI'];
			$this-&gt;info['plugin_version'] = $plugin_data['Version'];
			$this-&gt;info['plugin_description'] = $plugin_data['Description'];
			$this-&gt;info['plugin_author'] = $plugin_data['Author'];
			$this-&gt;info['plugin_author_uri'] = $plugin_data['AuthorURI'];
			$this-&gt;info['plugin_text_domain'] = $plugin_data['TextDomain'];
			$this-&gt;info['plugin_domain_path'] = $plugin_data['DomainPath']; 
			$this-&gt;info['plugin_network'] = $plugin_data['Network'];
			$this-&gt;info['plugin_title'] = $plugin_data['Title'];
			$this-&gt;info['plugin_author_name'] = $plugin_data['AuthorName'];
			# plugin_basename() is located in wp-includes/plugin.php
			$this-&gt;info['plugin_basename'] = plugin_basename($this-&gt;info['plugin_file']);
			$this-&gt;info['plugin_path'] = dirname($this-&gt;info['plugin_file']);
			$this-&gt;info['plugin_slug'] = basename($this-&gt;info['plugin_file'], &quot;.php&quot;);
			$this-&gt;info['plugin_prefix'] = $this-&gt;toSnakeCase(
										basename($this-&gt;info['plugin_slug']) );
			$this-&gt;info['plugin_url'] = WP_PLUGIN_URL.'/'.$this-&gt;info['plugin_slug'];
			$this-&gt;info['server_ip'] = $this-&gt;getServerIP();
		}

		/**
		* returns the numeric IP (as string) from which the WordPress  site 
		* is being served. This is helpful in differing behavior when on localhost.
		*
		* @access public
		*/
		public function getServerIP()
		{
			if ( array_key_exists('SERVER_ADDR', $_SERVER) ) 
				$server_ip = $_SERVER['SERVER_ADDR'];
			elseif ( array_key_exists('LOCAL_ADDR', $_SERVER) )
				$server_ip = $_SERVER['LOCAL_ADDR'];
			elseif ( array_key_exists('SERVER_NAME', $_SERVER) )
				$server_ip = gethostbyname($_SERVER['SERVER_NAME']);
			else {
				if(stristr(PHP_OS, 'WIN')) {
					$server_ip = gethostbyname(php_uname(&quot;n&quot;));
				} else {
					$ifconfig = shell_exec('/sbin/ifconfig eth0');
					preg_match('/addr:([\d\.]+)/', $ifconfig, $match);
					$server_ip = $match[1];
				}
			}
			return $server_ip;
		}

		/**
		* returns a large string displaying the contents of the $GLOBALS
		* array 
		* 
		* @return string representing contents of the $GLOBALS array
		* @access public
		*/
		public function viewGLOBALS()
		{
			$objects = '&lt;br&gt;Objects in $GLOBALS&lt;br&gt;';
			$arrays = '&lt;br&gt;Arrays in $GLOBALS&lt;br&gt;';
			$true = '&lt;br&gt;True in $GLOBALS&lt;br&gt;';
			$false = '&lt;br&gt;False in $GLOBALS&lt;br&gt;';
			$nulls = '&lt;br&gt;NULL in $GLOBALS&lt;br&gt;';
			$nums = '&lt;br&gt;Numbers in $GLOBALS&lt;br&gt;';
			$strs = '&lt;br&gt;Strings in $GLOBALS&lt;br&gt;';
			$else = '&lt;br&gt;others in $GLOBALS&lt;br&gt;';
			foreach ($GLOBALS as $key =&gt; $value) {
				if (is_object($value)) $objects .= &quot; '$key',&quot;;
				elseif (is_array($value)) $arrays .= &quot; '$key',&quot;;
				elseif (true === $value) $true .= &quot; '$key',&quot;;
				elseif (false === $value) $false .= &quot; '$key'&quot;;
				elseif (is_null($value)) $nulls .= &quot; '$key',&quot;;
				elseif (is_numeric($value)) $nums .= &quot; '$key' =&gt; $value,&lt;br&gt;&quot;;
				elseif (is_string($value)) $strs .= &quot; '$key' =&gt; '$value',&lt;br&gt;&quot;;
				else $else += &quot; '$key' =&gt; $value,&quot;;
			}
			return $objects . '&lt;br&gt;' . $arrays . '&lt;br&gt;' . $true . '&lt;br&gt;' 
				. $false . '&lt;br&gt;' . $nulls . '&lt;br&gt;' . $nums . $strs . $else;
		}

		/**
		* Saves viewGLOBALS to $this-&gt;logs['GLOBALS']
		* 
		* @return string representing contents of the $GLOBALS array
		* @access public
		*/
		public function writeLogs() {
			$this-&gt;logs['info'] = &quot;&lt;h2&gt;Plugin-&gt;info&lt;/h2&gt;&quot;
				. $this-&gt;arrayToString($this-&gt;info);
			$this-&gt;logs['GLOBALS'] = '&lt;h2&gt;$GLOBAL&lt;/h2&gt;'.$this-&gt;viewGLOBALS();
		}
	}
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>